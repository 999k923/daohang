<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é™æ€å¯¼èˆªç«™</title>

<style>
:root{
  --bg:#f6f7fb;
  --panel:#fff;
  --text:#101828;
  --muted:#667085;
  --line:rgba(16,24,40,.12);
  --primary:#2563eb;
  --danger:#ef4444;
  --ok:#10b981;
  --radius:16px;
  --shadow:0 10px 30px rgba(16,24,40,.12);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:var(--bg);
  color:var(--text);
}

a{color:inherit;text-decoration:none}

/* ===== Header ===== */
header{
  position:sticky;top:0;z-index:10;
  background:#fff;
  border-bottom:1px solid var(--line);
  padding:14px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}
header h1{margin:0;font-size:18px}

.toolbar{display:flex;gap:10px;flex-wrap:wrap}
.btn{
  border:1px solid var(--line);
  background:#fff;
  border-radius:999px;
  padding:8px 12px;
  cursor:pointer;
  font-size:13px;
}
.btn.primary{background:#eef2ff;border-color:#c7d2fe}
.btn.ok{background:#ecfdf5;border-color:#a7f3d0}
.btn.danger{background:#fef2f2;border-color:#fecaca}
.btn:disabled{opacity:.5;cursor:not-allowed}

.adminOnly{display:none}
body.isAdmin .adminOnly{display:inline-flex}

/* ===== Layout ===== */
.wrap{max-width:1200px;margin:0 auto;padding:20px}
.grid{
  display:grid;
  grid-template-columns:260px 1fr;
  gap:16px;
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}

.sidebar,.panel{
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}

/* ===== Sidebar ===== */
.sidebar{padding:12px;max-height:calc(100vh - 110px);overflow:auto}
.catItem{
  padding:10px;
  border-radius:12px;
  margin-bottom:6px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
}
.catItem.active{background:#eef2ff}

/* ===== Panel ===== */
.panel{padding:14px}
.subcats{display:flex;flex-direction:column;gap:16px}

.subcat{
  border:1px solid var(--line);
  border-radius:16px;
  background:#f9fafb;
}
.subHead{
  padding:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid var(--line);
}

/* ===== Cards ===== */
.cards{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
  padding:12px;
}
@media(max-width:900px){.cards{grid-template-columns:repeat(2,1fr)}}
@media(max-width:600px){.cards{grid-template-columns:1fr}}

.card{
  background:#fff;
  border:1px solid var(--line);
  border-radius:16px;
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:8px;
  min-height:150px;
}

.cardTitle{
  font-weight:700;
  font-size:14px;
  line-height:1.35;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
}

.cardUrl{
  font-size:12px;
  color:var(--muted);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.cardDesc{
  font-size:12px;
  color:#333;
  line-height:1.4;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
}

/* ===== Tooltip ===== */
.tooltip{
  position:fixed;
  z-index:99999;
  max-width:420px;
  background:rgba(17,24,39,.96);
  color:#fff;
  border-radius:14px;
  padding:10px 12px;
  box-shadow:0 18px 45px rgba(0,0,0,.3);
  display:none;
  pointer-events:none;
}
.tooltip .ttTitle{font-weight:700;font-size:13px;margin-bottom:6px}
.tooltip .ttUrl{font-size:12px;opacity:.9;word-break:break-all;margin-bottom:6px}
.tooltip .ttDesc{font-size:12px;opacity:.85;line-height:1.45}

/* ===== Modal / Toast ===== */
.modalMask{
  position:fixed;inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#111827;
  color:#fff;
  padding:8px 14px;
  border-radius:999px;
  display:none;
}
</style>
</head>
<body>
<header>
  <div>
    <h1>é™æ€å¯¼èˆªç«™</h1>
    <div style="font-size:12px;color:var(--muted)">VPS åŒæ­¥ï¼šSQLite æ•°æ®åº“ Â· ç®¡ç†å‘˜ç™»å½•åå¯ç¼–è¾‘</div>
  </div>

  <div class="toolbar">
    <input id="searchInput" placeholder="æœç´¢æ ‡é¢˜/æè¿°/URL..." style="padding:8px 12px;border-radius:999px;border:1px solid var(--line);min-width:260px" />

    <span id="loginBadge" style="font-size:12px;color:var(--muted);padding:8px 10px;border:1px solid var(--line);border-radius:999px;background:#fff">
      â— <span id="loginText">æ¸¸å®¢æ¨¡å¼</span>
    </span>

    <button class="btn" id="btnLogin">ç™»å½•</button>
    <button class="btn" id="btnLogout" style="display:none">é€€å‡º</button>

    <button class="btn primary adminOnly" id="btnAddTop">+ æ–°å¢ä¸€çº§</button>
    <button class="btn ok adminOnly" id="btnAddSub">+ æ–°å¢äºŒçº§</button>
    <button class="btn ok adminOnly" id="btnAddSite">+ æ–°å¢ç½‘ç«™</button>
    <button class="btn adminOnly" id="btnExport">å¯¼å‡ºJSON</button>
    <button class="btn adminOnly" id="btnImport">å¯¼å…¥JSON</button>
  </div>
</header>

<div class="wrap">
  <div class="grid">
    <aside class="sidebar">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <b style="font-size:13px;color:var(--muted)">ä¸€çº§åˆ†ç±»</b>
        <span style="font-size:12px;color:var(--muted)">åŒæ­¥æ¥è‡ªæ•°æ®åº“</span>
      </div>
      <div id="catList"></div>
    </aside>

    <main class="panel">
      <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:10px;flex-wrap:wrap">
        <div>
          <h2 id="activeTitle" style="margin:0;font-size:16px">-</h2>
          <div id="activeMeta" style="font-size:12px;color:var(--muted)">-</div>
        </div>
      </div>
      <div id="content" style="margin-top:12px"></div>
    </main>
  </div>
</div>

<!-- Modal -->
<div class="modalMask" id="modalMask">
  <div style="width:min(720px,100%);background:#fff;border-radius:16px;border:1px solid var(--line);box-shadow:var(--shadow);overflow:hidden">
    <div style="padding:12px 14px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center">
      <b id="modalTitle">ç¼–è¾‘</b>
      <button class="btn" id="modalClose">å…³é—­</button>
    </div>
    <div id="modalBody" style="padding:14px;display:flex;flex-direction:column;gap:10px"></div>
    <div id="modalFoot" style="padding:12px 14px;border-top:1px solid var(--line);display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap"></div>
  </div>
</div>

<!-- Tooltip -->
<div class="tooltip" id="tooltip">
  <div class="ttTitle" id="ttTitle"></div>
  <div class="ttUrl" id="ttUrl"></div>
  <div class="ttDesc" id="ttDesc"></div>
</div>

<div class="toast" id="toast"></div>

<script>
/** ==========================
 *  API é…ç½®ï¼ˆåŒåŸŸåä»£ /apiï¼‰
 * ========================== */
const API_DATA_URL = "/api/data";
const API_LOGIN_URL = "/api/login";
const API_LOGOUT_URL = "/api/logout";
const TOKEN_KEY = "navsite_api_token_v1";
const LOCAL_CACHE_KEY = "navsite_local_cache_v1";

/** ==========================
 *  State
 * ========================== */
let state = { version: 1, updatedAt: new Date().toISOString(), categories: [] };
let activeCatId = null;
let searchText = "";

/** ==========================
 *  Utils
 * ========================== */
function uid(){ return Math.random().toString(16).slice(2) + Date.now().toString(16); }
function byOrder(a,b){ return (a.order ?? 0) - (b.order ?? 0); }
function nextOrder(arr){ return (arr||[]).reduce((m,x)=>Math.max(m, Number(x.order)||0),0)+1; }
function fmtTime(iso){
  try{
    const d = new Date(iso);
    const p=n=>String(n).padStart(2,"0");
    return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())} ${p(d.getHours())}:${p(d.getMinutes())}`;
  }catch{return iso}
}
function toast(msg){
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.style.display="block";
  clearTimeout(toast._timer);
  toast._timer=setTimeout(()=>t.style.display="none",1700);
}

function getToken(){ return sessionStorage.getItem(TOKEN_KEY) || ""; }
function isAdmin(){ return !!getToken(); }
function setAdminToken(token){
  if(token) sessionStorage.setItem(TOKEN_KEY, token);
  else sessionStorage.removeItem(TOKEN_KEY);
  document.body.classList.toggle("isAdmin", !!token);
  syncLoginUI();
  render();
}
function syncLoginUI(){
  const btnLogin = document.getElementById("btnLogin");
  const btnLogout = document.getElementById("btnLogout");
  const loginText = document.getElementById("loginText");
  btnLogin.style.display = isAdmin() ? "none" : "inline-flex";
  btnLogout.style.display = isAdmin() ? "inline-flex" : "none";
  loginText.textContent = isAdmin() ? "ç®¡ç†å‘˜å·²ç™»å½•" : "æ¸¸å®¢æ¨¡å¼";
}

/** URL æ˜¾ç¤ºçŸ­é“¾æ¥ï¼ˆä¸æ’‘é«˜åº¦ï¼‰ */
function shortUrl(url){
  try{
    const u = new URL(url);
    return u.host + "/â€¦";
  }catch{
    return url || "";
  }
}

/** favicon / icon */
function getDomainFromUrl(u){ try { return new URL(u).hostname; } catch { return ""; } }
function autoFaviconUrl(siteUrl, size=64){
  const domain = getDomainFromUrl(siteUrl);
  if(!domain) return "";
  return `https://www.google.com/s2/favicons?domain=${encodeURIComponent(domain)}&sz=${size}`;
}
function placeholderIconDataUrl(){
  return "data:image/svg+xml;base64," + btoa(
    `<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'>
      <rect width='64' height='64' rx='18' fill='rgba(16,24,40,.05)'/>
      <path d='M22 32h20' stroke='rgba(16,24,40,.35)' stroke-width='4' stroke-linecap='round'/>
    </svg>`
  );
}
function resolveIconSrc(site){
  const manual = (site.icon || "").trim();
  if(manual) return manual;
  const auto = autoFaviconUrl(site.url, 64);
  return auto || placeholderIconDataUrl();
}

/** ==========================
 *  Tooltip Preview
 * ========================== */
const TT = { el:null, t:null, u:null, d:null, visible:false };
function initTooltip(){
  TT.el = document.getElementById("tooltip");
  TT.t  = document.getElementById("ttTitle");
  TT.u  = document.getElementById("ttUrl");
  TT.d  = document.getElementById("ttDesc");
}
function showTooltip(payload){
  if(!TT.el) initTooltip();
  TT.t.textContent = payload.title || "";
  TT.u.textContent = payload.url || "";
  TT.d.textContent = payload.desc || "";
  TT.el.style.display = "block";
  TT.visible = true;
}
function hideTooltip(){
  if(!TT.el) return;
  TT.el.style.display="none";
  TT.visible=false;
}
function moveTooltip(clientX, clientY){
  if(!TT.el || !TT.visible) return;
  const margin=14, offset=16;
  let x=clientX+offset, y=clientY+offset;
  const rect = TT.el.getBoundingClientRect();
  if(x+rect.width+margin>window.innerWidth) x=clientX-rect.width-offset;
  if(y+rect.height+margin>window.innerHeight) y=clientY-rect.height-offset;
  x=Math.max(margin, Math.min(x, window.innerWidth-rect.width-margin));
  y=Math.max(margin, Math.min(y, window.innerHeight-rect.height-margin));
  TT.el.style.left=x+"px";
  TT.el.style.top=y+"px";
}

/** ==========================
 *  Modal
 * ========================== */
const modalMask = document.getElementById("modalMask");
const modalTitle = document.getElementById("modalTitle");
const modalBody = document.getElementById("modalBody");
const modalFoot = document.getElementById("modalFoot");
document.getElementById("modalClose").onclick = closeModal;
modalMask.addEventListener("click", (e)=>{ if(e.target===modalMask) closeModal(); });

function openModal(title, bodyNodes, footNodes){
  modalTitle.textContent = title;
  modalBody.innerHTML="";
  modalFoot.innerHTML="";
  bodyNodes.forEach(n=>modalBody.appendChild(n));
  footNodes.forEach(n=>modalFoot.appendChild(n));
  modalMask.style.display="flex";
}
function closeModal(){ modalMask.style.display="none"; }

function button(text, cls, onClick){
  const b=document.createElement("button");
  b.className=cls;
  b.textContent=text;
  b.onclick=onClick;
  return b;
}
function input(labelText, value="", type="text"){
  const wrap=document.createElement("div");
  const lab=document.createElement("div");
  lab.textContent=labelText;
  lab.style.fontSize="12px";
  lab.style.color="var(--muted)";
  lab.style.marginBottom="6px";
  const el=document.createElement("input");
  el.type=type;
  el.value=value??"";
  el.style.width="100%";
  el.style.padding="10px";
  el.style.border="1px solid var(--line)";
  el.style.borderRadius="12px";
  el.autocomplete="off";
  wrap.append(lab, el);
  return {wrap, el};
}
function textarea(labelText, value=""){
  const wrap=document.createElement("div");
  const lab=document.createElement("div");
  lab.textContent=labelText;
  lab.style.fontSize="12px";
  lab.style.color="var(--muted)";
  lab.style.marginBottom="6px";
  const el=document.createElement("textarea");
  el.value=value??"";
  el.style.width="100%";
  el.style.padding="10px";
  el.style.border="1px solid var(--line)";
  el.style.borderRadius="12px";
  el.style.minHeight="90px";
  wrap.append(lab, el);
  return {wrap, el};
}
function row2(a,b){
  const r=document.createElement("div");
  r.style.display="flex";
  r.style.gap="10px";
  r.append(a,b);
  a.style.flex="1"; b.style.flex="1";
  return r;
}

/** ==========================
 *  API Calls
 * ========================== */
async function apiGetData(){
  const res = await fetch(API_DATA_URL, { cache:"no-store" });
  if(!res.ok) throw new Error("GET /api/data failed");
  const obj = await res.json();
  obj.categories ||= [];
  obj.categories.forEach(c=>{
    c.subcategories ||= [];
    c.subcategories.forEach(s=>{
      s.sites ||= [];
      s.sites.forEach(site=>{ if(typeof site.icon !== "string") site.icon=""; });
    });
  });
  return obj;
}
async function apiLogin(username, password){
  const res = await fetch(API_LOGIN_URL, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ username, password })
  });
  if(!res.ok) throw new Error("login failed");
  return await res.json();
}
async function apiLogout(){
  const token=getToken();
  if(!token) return;
  try{
    await fetch(API_LOGOUT_URL, { method:"POST", headers:{ "Authorization":"Bearer "+token } });
  }catch{}
}
async function apiSaveData(){
  if(!isAdmin()) return;
  const token=getToken();
  const res = await fetch(API_DATA_URL, {
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+token
    },
    body: JSON.stringify(state)
  });
  if(!res.ok){
    if(res.status===401){
      toast("ä¿å­˜å¤±è´¥ï¼šç™»å½•å·²è¿‡æœŸ");
      setAdminToken("");
      return;
    }
    toast("ä¿å­˜å¤±è´¥ï¼š"+res.status);
    return;
  }
  const out = await res.json();
  if(out?.updatedAt) state.updatedAt = out.updatedAt;
}

function saveLocalCache(){ try{ localStorage.setItem(LOCAL_CACHE_KEY, JSON.stringify(state)); }catch{} }
function loadLocalCache(){ try{ const raw=localStorage.getItem(LOCAL_CACHE_KEY); return raw?JSON.parse(raw):null; }catch{return null;} }
async function saveAll(){
  saveLocalCache();
  await apiSaveData();
}

function requireAdmin(){
  if(!isAdmin()){
    toast("éœ€è¦ç®¡ç†å‘˜ç™»å½•");
    openLoginModal();
    return false;
  }
  return true;
}

/** ==========================
 *  Render
 * ========================== */
function getActiveCat(){
  return state.categories.find(c=>c.id===activeCatId) || state.categories[0] || null;
}

function render(){
  renderSidebar();
  renderContent();
}

function renderSidebar(){
  const list=document.getElementById("catList");
  list.innerHTML="";
  const cats=[...(state.categories||[])].sort(byOrder);
  if(!activeCatId && cats[0]) activeCatId=cats[0].id;

  cats.forEach(cat=>{
    const item=document.createElement("div");
    item.className="catItem"+(cat.id===activeCatId?" active":"");
    item.onclick=()=>{ activeCatId=cat.id; render(); };

    const left=document.createElement("div");
    left.textContent=cat.name;

    const right=document.createElement("div");
    right.style.display="flex";
    right.style.gap="6px";

    const edit=document.createElement("button");
    edit.className="btn adminOnly";
    edit.textContent="âœ";
    edit.style.padding="6px 10px";
    edit.onclick=(e)=>{ e.stopPropagation(); openCategoryModal(cat); };

    const del=document.createElement("button");
    del.className="btn danger adminOnly";
    del.textContent="ğŸ—‘";
    del.style.padding="6px 10px";
    del.onclick=async(e)=>{
      e.stopPropagation();
      if(!requireAdmin()) return;
      if(confirm(`ç¡®å®šåˆ é™¤ã€Œ${cat.name}ã€ï¼Ÿ`)){
        state.categories = state.categories.filter(c=>c.id!==cat.id);
        if(activeCatId===cat.id) activeCatId = state.categories[0]?.id || null;
        await saveAll();
        render();
      }
    };

    right.append(edit, del);
    item.append(left, right);
    list.appendChild(item);
  });
}

function renderContent(){
  const cat=getActiveCat();
  const content=document.getElementById("content");
  const title=document.getElementById("activeTitle");
  const meta=document.getElementById("activeMeta");

  if(!cat){
    title.textContent="æ²¡æœ‰åˆ†ç±»";
    meta.textContent="è¯·ç®¡ç†å‘˜ç™»å½•åæ–°å¢";
    content.innerHTML="<div style='padding:20px;color:var(--muted)'>æš‚æ— æ•°æ®</div>";
    return;
  }

  title.textContent=cat.name;
  meta.textContent=`äºŒçº§åˆ†ç±»ï¼š${cat.subcategories?.length||0} Â· æœ€è¿‘æ›´æ–°ï¼š${fmtTime(state.updatedAt)}`;

  const subcats=(cat.subcategories||[]).slice().sort(byOrder);

  // æœç´¢
  if(searchText.trim()){
    const q=searchText.trim().toLowerCase();
    const matched=[];
    subcats.forEach(sc=>{
      const sites=(sc.sites||[]).filter(s=>{
        return (s.title||"").toLowerCase().includes(q)
          || (s.desc||"").toLowerCase().includes(q)
          || (s.url||"").toLowerCase().includes(q);
      }).sort(byOrder);
      if(sites.length) matched.push({sc, sites});
    });
    if(!matched.length){
      content.innerHTML="<div style='padding:20px;color:var(--muted)'>æ²¡æœ‰æœç´¢ç»“æœ</div>";
      return;
    }
    const wrap=document.createElement("div");
    wrap.className="subcats";
    matched.forEach(({sc, sites})=>wrap.appendChild(renderSubcatBlock(cat, sc, sites, true)));
    content.innerHTML="";
    content.appendChild(wrap);
    return;
  }

  if(!subcats.length){
    content.innerHTML="<div style='padding:20px;color:var(--muted)'>æš‚æ— äºŒçº§åˆ†ç±»</div>";
    return;
  }

  const wrap=document.createElement("div");
  wrap.className="subcats";
  subcats.forEach(sc=>{
    const sites=(sc.sites||[]).slice().sort(byOrder);
    wrap.appendChild(renderSubcatBlock(cat, sc, sites, false));
  });

  content.innerHTML="";
  content.appendChild(wrap);
}

function renderSubcatBlock(cat, subcat, sites, searchMode){
  const box=document.createElement("div");
  box.className="subcat";

  const head=document.createElement("div");
  head.className="subHead";

  const left=document.createElement("div");
  left.innerHTML=`<b>${subcat.name}</b> <span style="color:var(--muted);font-size:12px">ï¼ˆç½‘ç«™ ${sites.length}ï¼‰</span>`;

  const right=document.createElement("div");
  right.style.display="flex";
  right.style.gap="8px";
  right.style.flexWrap="wrap";

  if(!searchMode){
    const add=button("æ–°å¢ç½‘ç«™","btn ok adminOnly",()=>{ if(requireAdmin()) openSiteModal(cat, subcat, null); });
    right.appendChild(add);
  }
  right.appendChild(button("ç¼–è¾‘äºŒçº§","btn adminOnly",()=>{ if(requireAdmin()) openSubcategoryModal(cat, subcat); }));
  right.appendChild(button("åˆ é™¤äºŒçº§","btn danger adminOnly",async()=>{
    if(!requireAdmin()) return;
    if(confirm(`ç¡®å®šåˆ é™¤äºŒçº§ã€Œ${subcat.name}ã€ï¼Ÿ`)){
      cat.subcategories = cat.subcategories.filter(s=>s.id!==subcat.id);
      await saveAll();
      render();
    }
  }));

  head.append(left,right);

  const cards=document.createElement("div");
  cards.className="cards";

  if(!sites.length){
    const empty=document.createElement("div");
    empty.style.gridColumn="1/-1";
    empty.style.padding="18px";
    empty.style.color="var(--muted)";
    empty.textContent=isAdmin() ? "æš‚æ— ç½‘ç«™ï¼Œç‚¹å‡»æ–°å¢æ·»åŠ ã€‚" : "æš‚æ— ç½‘ç«™ï¼ˆç®¡ç†å‘˜ç™»å½•åå¯æ·»åŠ ï¼‰ã€‚";
    cards.appendChild(empty);
  }else{
    sites.forEach(site=>cards.appendChild(renderSiteCard(cat, subcat, site)));
  }

  box.append(head, cards);
  return box;
}

function renderSiteCard(cat, subcat, site){
  const card=document.createElement("div");
  card.className="card";

  // Tooltip hover
  card.addEventListener("mouseenter",(e)=>{
    if(window.matchMedia && window.matchMedia("(hover: none)").matches) return;
    showTooltip({ title: site.title||"", url: site.url||"", desc: site.desc||"" });
    moveTooltip(e.clientX, e.clientY);
  });
  card.addEventListener("mousemove",(e)=>moveTooltip(e.clientX, e.clientY));
  card.addEventListener("mouseleave",()=>hideTooltip());

  const top=document.createElement("div");
  top.style.display="flex";
  top.style.justifyContent="space-between";
  top.style.gap="10px";

  const left=document.createElement("div");
  left.style.display="flex";
  left.style.gap="10px";
  left.style.minWidth="0";

  const icon=document.createElement("img");
  icon.src=resolveIconSrc(site);
  icon.onerror=()=>{ icon.onerror=null; icon.src=placeholderIconDataUrl(); };
  icon.style.width="34px";
  icon.style.height="34px";
  icon.style.borderRadius="12px";
  icon.style.border="1px solid rgba(16,24,40,.12)";
  icon.style.flex="0 0 auto";

  const info=document.createElement("div");
  info.style.minWidth="0";

  const t=document.createElement("div");
  t.className="cardTitle";
  t.textContent=site.title||"(æœªå‘½å)";
  t.title = site.title || "";

  const u=document.createElement("a");
  u.className="cardUrl";
  u.href=site.url||"#";
  u.target="_blank";
  u.rel="noopener noreferrer";
  u.textContent=shortUrl(site.url);
  u.title=site.url||"";

  info.append(t,u);
  left.append(icon,info);

  const acts=document.createElement("div");
  acts.style.display="flex";
  acts.style.gap="6px";

  const go=button("â†—","btn",()=>site.url?window.open(site.url,"_blank","noopener,noreferrer"):toast("æ— URL"));
  go.style.padding="6px 10px";

  const edit=button("âœ","btn adminOnly",()=>{ if(requireAdmin()) openSiteModal(cat, subcat, site); });
  edit.style.padding="6px 10px";

  const del=button("ğŸ—‘","btn danger adminOnly",async()=>{
    if(!requireAdmin()) return;
    if(confirm(`ç¡®å®šåˆ é™¤ã€Œ${site.title}ã€ï¼Ÿ`)){
      subcat.sites = (subcat.sites||[]).filter(s=>s.id!==site.id);
      await saveAll();
      render();
    }
  });
  del.style.padding="6px 10px";

  acts.append(go, edit, del);

  top.append(left, acts);

  const desc=document.createElement("div");
  desc.className="cardDesc";
  desc.textContent=site.desc||"";

  card.append(top, desc);
  return card;
}

/** Part 3 å°†åŒ…å«ï¼šç™»å½•å¼¹çª— + å®Œæ•´ CRUD + ä¸Šä¼  icon(base64) + å¯¼å…¥å¯¼å‡º + boot åˆå§‹åŒ– **/
</script>
  
  
